Wed May 25 18:28:37 UTC 2022 Hourly Data Refresh started

Refresh data between 2022-05-22 and 2022-06-24

........... AiropsMovement ...........


ClientSQL:
SELECT DISTINCT
    [FlightLegId] as airopsmovementId
    ,case when [IsEmptyLeg] = 1 or [TripType] = 'Repo Leg' then null else [FlightLegId] end as atlasFlightId
    ,[TripNumber] as airopsId
    ,[LegNumber] as legNumber
    ,apf.[ID] fromAirportId
    ,apt.[ID] toAirportId
    ,[Departure] fromAirport
    ,[Arrival] toAirport
    ,[ScheduledOutDateUTC] as scheduledDepartureDateTimeUTC
    ,[ScheduledOutDateUTC] + [DepartureDate]-[DepartureDateUTC] as scheduledDepartureDateTimeLoc
    ,[ScheduledInDateUTC] as scheduledArrivalDateTimeUTC
    ,[ScheduledInDateUTC] + [ArrivalDate]-[ArrivalDateUTC] as scheduledArrivalDateTimeLocal
    ,[ScheduledDepartureDateUTC] as scheduledTakeOffDateTimeUTC
    ,[ScheduledDepartureDateUTC] + [DepartureDate]-[DepartureDateUTC] as scheduledTakeOffDateTimeLocal
    ,[ScheduledArrivalDateUTC] as scheduledLandingDateTimeUTC
    ,[ScheduledArrivalDateUTC] + [ArrivalDate]-[ArrivalDateUTC] as scheduledLandingDateTimeLocal
    ,DATEDIFF(minute,[ScheduledOutDateUTC], [ScheduledInDateUTC]) scheduledBlockTime
    ,DATEDIFF(minute,[ScheduledDepartureDateUTC], [ScheduledArrivalDateUTC]) scheduledFlyingTime
    ,[AircraftType] as aircraftType
    ,f.[TailNumber] as aircraftRegistration
    ,[OutBlocksUTC] as actualDepartureDateTimeUTC
    ,[InBlocksUTC] as actualArrivalDateTimeUTC
    ,[ActualDepartureDateUTC] as actualTakeOffDateTimeUTC
    ,[ActualArrivalDateUTC] as actualLandingDateTimeUTC
    ,[OutBlocksUTC] + [DepartureDate]-[DepartureDateUTC] as actualDepartureDateTimeLocal
    ,[InBlocksUTC]  + [ArrivalDate]-[ArrivalDateUTC] as actualArrivalDateTimeLocal
    ,[ActualDepartureDateLocal] as actualTakeOffDateTimeLocal
    ,[ActualArrivalDateLocal] as actualLandingDateTimeLocal
    ,DATEDIFF(minute,[OutBlocksUTC], [InBlocksUTC]) actualBlockTime
    ,DATEDIFF(minute,[ActualDepartureDateUTC], [ActualArrivalDateUTC]) actualFlyingTime
    ,[IsEmptyLeg] as deadHead
    ,[TripType] as legType
    ,[Customer] as requesterName
    ,[Pax Count] as paxCount
    ,[FlightLegGuidID] as FlightLegGuidID
    ,[Created] as bookedDateTime
    ,[RowVersion] as rowversion
FROM [bi].[FlightDataAnalysis] f
LEFT JOIN [bi].[AircraftAnalysis] a on f.[TailNumber] = a.[TailNumber]
LEFT JOIN [dbo].[OperatorCertificate] o on a.[OperatorCertificateID] = o.[GuidID]
LEFT JOIN [dbo].[Airport] apf on f.[DepartureAirportID] = apf.[DirectoryGuidID] and apf.active = 1
LEFT JOIN [dbo].[Airport] apt on f.[ArrivalAirportID] = apt.[DirectoryGuidID] and apt.active = 1
WHERE f.[LegStatus] <> 'Cancelled' -- exclude Cancelled
AND (o.[Name] = 'Gama Aviation LLC' or Upper(f.[TailNumber]) like 'GAMA%' or Upper(f.[TailNumber]) like '1P - BDR%')
AND [ArrivalDateUTC] >= '2022-05-22' 
AND [DepartureDateUTC] <= '2022-06-24';
